---
title: "计算机网络面试题"
date: 2020-12-01
draft: false
toc: true
categories: ["面试"]
tags: ["计算机网络", "面试题"]
---

## 应用层
### HTTP
报文格式: 
```
GET /somedir/page.html HTTP/1.1    请求行: 请求方法, URL, 协议/版本
Host: www.someschool.com           多个请求头
onnection: close                   
User-agent: Mozilla/5.0
Accept-language: fr
                                   空行
实体内容
```

### 请求头对比
- GET: 数据在包头, 明文, 不安全, 长度小, 查询数据
- POST: 数据在HTTP正文, 可明可密, 安全, 支持大数据传输, 修改数据
- PUT: 一般和Web发行工具一起用, 允许用户上传对象到指定服务器目录
- DELETE: 删除Web服务器的对象
- HEAD: 类似GET, 但是只获取头

HTTP可以通过conditional GET来群确认存储的副本是最新的. 如果报文是用的GET方法, 并且请求报文中包含一个IF-Modified-Since首部行, 这个HTTP请求就是conditional GET, 告诉Web服务器如果在这个时间之后如果修改过, 才发送此对象. 如果没有修改, 服务器就会给缓存器一个304 Not Modified, 缓存器就可以给浏览器发送已经保存的副本. 如果修改了, 则服务器会返回普通的200 OK.

### 响应报文
|     | 类别 | 原因短语 |
| --- | --- | --- |
| 1xx | Informational(信息性状态码) | 接受的请求正在处理 |
| 2xx | Success(成功状态码) | 请求正常处理完毕 |
| 3xx | Redirection(重定向状态码) | 需要进行附加操作一完成请求 |
| 4xx | Client Error (客户端错误状态码) | 服务器无法处理请求 |
| 5xx | Server Error(服务器错误状态码) | 服务器处理请求出错 |

- 200 OK: 请求成功, 信息在返回的响应报文中
- 301 Moved Permanently: 请求的对象被永久转移了, 新的URL定义在响应报文Location: 首部行中, 客户软件自动获取新的URL
- 400 Bad Request: 服务器不理解请求
- 404 Not Found: 被请求的文档不在服务器上
- 505 HTTP Version Not Supported: 服务器不支持请求报文使用的HTTP协议版本.

### DNS
浏览器缓存->host文件->路由缓存->找DNS服务器(通过递归或迭代方式查找本地, 顶级, 根).

共同实现DNS分布式数据库的所有DNS服务器存储了**资源记录(Resource Record, RR)**, 其提供主机名到IP地址的映射. 每个DNS回答包含了一条或多条RR. RR包括了``Name, Value, Type, TTL``这样一个四元组. TTL记录生存时间(下面例子中忽略). Name和Value取决于Type.
- Type=A, 则Name为主机名, Value对应其IP地址, 把域名解析到IP地址.  eg. (relay1.bar.foo.com, 145.37.93.126, A)
- Type=NS, 则Name为个域(foo.com), Value为存储域中主机IP的**权威DNS服务器**的主机名. eg. (foo.com, dns.foo.com, NS)
- Type=CNAME, Value是别名为Name的主机对应的规范主机名, 简单的说就是**把域名解析到另外一个域名**. 如果使用CDN服务, 供应商就可以给你一个地址, 而ip地址可以灵活地变化, 实现CDN加速. eg. (foo.com, relay1.bar.foo.com, CNAME)
- Type=MX, 则Value是别名为Name的邮件服务器规范主机名. eg. (foo.com, relay1.bar.foo.com, MX)

### Cookie/Session
cookie相当于在无状态的HTTP上建立了用户会话层, 如上图, 在客户主机收到了Set-cookie之后, 浏览器就会在其管理的cookie文件中加包含服务器的主机名和在Set-cookie首部中的识别码. 当客户机继续访问时就会在HTTP请求报文加上这个识别码. Web服务器就由此追踪用户. 比如在淘宝买东西时的购物车就可以通过这种形式来记住某个用户的购物车内容.

无法通过简单的cookie机制传递很多信息, 大的cookie字段在HTTP header中会消耗很多带宽. session是一个数据结构, 存储在服务器中(因此有过期时间), 如果后面用户重新登录, 那么服务器会新建一个session, 将session ID通过cookie的形式传送给客户端.

所以Session是在服务端保存的一个数据结构, 用来跟踪保存**用户的状态**, 这个数据可以保存在集群/数据库/文件中. 
Cookie是客户端保存**用户信息**的一种机制, 用来记录用户的一些信息, 也是实现Session的一种方式. 所以停用cookie, session也会失效, 除非用url去传递

### HTTP1.1/HTTP2.0
2.0是二进制格式而非文本格式. 1.1比1.0多了持续链接.

### HTTP/HTTPS
https相当于http+ssl/tls, s指secure. HTTP安全性没有HTTPS高, 但HTTPS比HTTP耗费更多服务器资源. 端口80/443. 明文/加密. 

ssl是非对称加密(公开密钥加密), 用公有密钥加密, 私有密钥解密. 对称加密问题是密钥也没法送到对方. TSL是以SSL为原型开发的协议. 加密通信会消耗更多的CPU及内存资源, 加密的证书也需要购买. 

### restful
[restful](https://www.ruanyifeng.com/blog/2011/09/restful.html)

## 传输层
### TCP/UDP
1. TCP面向连接, UDP面向无链接
2. TCP面向(有序)字节流, UDP面向报文
3. TCP提供可靠传输服务(数据顺序/正确性), UDP传输不可靠
4. TCP传输速度慢, UDP协议传输速度快
5. TCP socket(源IP, 源端口号, 目的IP, 目的端口号), UDP socket(目的IP, 目的端口号)
6. TCP头20byte: 16bit源端口号/16bit目的端口号/32bit seq/32bit ack/... , UDP头8byte: 16bit源端口号/16bit目的端口号/16bit长度/16bit检验和

### TCP可靠性
1. 确认机制
2. 超时重传机制, 根据RTT时间估算
3. 校验和
4. 流量控制, 防止接收缓存不够, 丢包. 接收方让发送方知道剩余缓存空间(rwnd)为多少, 即使为0, 发送方也会发送1个字节的班文段, 让接收方清空缓存, 防止阻塞. 发送方监控**已发送但是未确认**的数据小于rwnd. 滑动窗口. 在头中. 单位是byte.
5. 阻塞控制, 网络阻塞的时候减少数据发送

### TCP阻塞控制
慢启动->慢启动阈值ssthresh(cwnd/2)->阻塞避免. 3次冗余的ACK: ssthresh设置为cwnd/2, cwnd为ssthresh+3个MSS, 进入快速恢复状态; 3次冗余的ACK出现是因为接收方收到了失序的数据, 让发送方快速重传, 不必等待重传计时器到期, 增加吞吐量. 如果超时, 会重新慢启动.

cwnd指阻塞窗口, 单位是MSS, 应用层数据的最大长度(1460byte), 不包括20byte的ip头和20byte的TCP头.

### 三次握手 四次挥手(!!!)
3: 防止已过期的连接请求报文突然又传送到服务器

4: 确保数据能够完成传输. 但关闭连接时, 仅仅表示对方没有数据发送给你了, 但未必你所有的数据都全部发送给对方了, 所以要等数据发完, 再发送FIN报文给对方来表示你同意现在可以关闭连接了.

https://blog.csdn.net/qzcsu/article/details/72861891

## 网络层
### IP报文
最小20byte, 包括版本/长度/服务类型/数据报总长度/生存时间/校验和/目标ip/源ip等/运输层协议. 可能分片, 因为MTU只有1500byte.

- 不可靠: 不能保证数据报能成功地到达目的地, 发生错误用ICMP发送消息给源
- 无连接: IP不维护关于后续数据报的状态信息, 发送连续但接受不一定连续

### 路由选择
根据最长匹配原则, 找到条目, 发送到指定的路由器. 如果不能找到, 返回一个"主机不可达"或"网络不可达"的错误.

### IP分类
1. A类地址: 首位为0, 1.0.0.1~~126.255.255.254; 主机号24位
2. B类地址: 首位为10, 128.0.0.1~~191.255.255.254; 主机号16位
3. C类地址: 首位为110, 192.0.0.1~~223.255.255.254; 主机号8位
4. D类地址(多播地址, 也叫做组播地址): 首位为 1110, 224.0.0.1~~239.255.255.254
5. E类地址: 此类地址是保留地址, 首位为11110, 240.0.0.1~~254.255.255.254

### ICMP
控制报文协议, 为了更高效的转发IP数据报和提高交付成功的机会, 封装在ip数据报内. 重定向一般是找到了最优路径, 由路由器生成, 给主机使用. 不可达是找不到相应路径. ip的TTL过期. ping也是icmp的一种应用. ICMP最后会发回给源主机. 

https://mp.weixin.qq.com/s/DfQT3Vw2xaq60YIil-7Yxw

不会导致ICMP差错报文的情况:
1. ICMP差错报文
2. 目的地址是广播地址或者多播地址的IP数据报
3. 链路层广播的数据报
4. 不是IP分片的第一片
5. 源地址不是单个主机的数据包

## 链路层
### ARP
将IP地址解析为MAC地址.

## 综合
### 分层
- 应用层: 任务是通过**应用进程**间的交互来完成特定网络应用; HTTP, SMTP, FTP; 报文(message)
- 表示层/会话层: 负责向主机之间的不同进程的通信提供通用的数据传输服务; 加密解密/不同用户间的会话管理和建立
- 运输层: ;TCP/UDP; 报文段(segment)
- 网络层: ;IP协议; 数据报(datagram)
- 链路层: ;帧(frame)
- 物理层: 把帧中的比特从一个节点移动到下一个节点.

### http请求经历的步骤
https://huanruiz.github.io/post/csbase/9_%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E9%93%BE%E8%B7%AF%E5%B1%82/


## 参考
1. 计算机网络-自顶向下方法(第6版)
2. Computer Networking A Top-Down Approach(7th edition)
3. [作业](https://github.com/moranzcw/Computer-Networking-A-Top-Down-Approach-NOTES)
4. [习题答案](https://github.com/jzplp/Computer-Network-A-Top-Down-Approach-Answer)
5. 程序羊-计算机网络面试题总结
6. [JavaGuide-计算机网络](https://github.com/Snailclimb/JavaGuide/blob/master/docs/network/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.md)
7. [cookie和session到底是什么](https://mp.weixin.qq.com/s/lEAFW9ZSiqHJOfMnznPPHA)
8. [三次握手/四次挥手](https://blog.csdn.net/qzcsu/article/details/72861891)